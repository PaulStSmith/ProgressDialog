# ProgressDialog
.NET implementation of the standard Windows progress dialog. [archival]

This is an old project of mine, that I created back in 2005.<br/>
Imported into GitHub for archival puposes only.<br/>
There will be no updates.

## Screenshot
<img alt='Screenshot for ProgressDialog Class' src='http://pjondevelopment.50webs.com/images/articles/7.gif' width='400' height='288' />

<h2>Introduction</h2><p>This code is a by-product of a bigger project. In my project I needed a way of informing the user of the progress of a said task. Searching over the net I found the <a href="http://www.codeproject.com/dotnet/winprogressdialog.asp" shape="rect">initial component </a>created by <a href="http://www.codeproject.com/script/profile/whos_who.asp?id=197557" shape="rect"><b>sytelus</b></a>, that uses a TypeLib file to create an Interop layer. By other hand, <b><a href="http://www.codeproject.com/script/profile/whos_who.asp?id=186321" shape="rect">Russkie</a></b>, in his <a href="http://www.codeproject.com/csharp/IProgressDialogNET.asp" shape="rect">project </a>created a wrapper purely in C#. <br /><br />However, although I do like C#, I feel more comfortable working in VB. So, I started porting Russkie's project to Visual Basic. </p><h2>Background</h2><p>I would like to call your attention to the indication that this VB version is compatible only with <b>.NET 2.0</b> as stated on top of this page. It's not that I don't want to develop using .NET 1.1 the problem is that VB7 has a bug regarding the use of <a href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemruntimeinteropservicescomimportattributeclasstopic.asp" shape="rect">ComImport</a>&nbsp;as can be seen on <a href="http://support.microsoft.com/?kbid=313506" shape="rect">MSDN</a>.<br /><br />Although on MSDN they say that this bug affects only VB.NET 2002 it also affects the 2003 version, one more reason for the use of Visual Studio 2005. </p><h2>A Different Approach</h2><p>Russkie's component is a great implementation, no doubt, but it uses some concepts that, in my humble opinion, feel a little bit awkward.<br /><br />For instance, when the method <code>Start</code> is called it not only shows the ProgressDialog but it also goes through a iterative loop calling the <code>Callback Delegate</code> that should process whatever function is needed.<br /><br />My approach to this problem is a little bit straightforward: the <b>main</b> loop starts the ProgressDialog at the beginning, updates the progress value while in process (noting the process cancellation by the user), and finally closes de dialog.<br /><br />His implementation also relies on the <code>Flags</code> property, which is a map of bits. Although I kept the <code>Flags</code> property, I also added a few properties that are easier recognizable than a cryptic <code>Flags</code> property. </p><h2>ProgressDialog members</h2><h3>Public Enumerators </h3><table id="Table4" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Constructor" src="http://pjondevelopment.50webs.com/images/class/enum.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>dlgAnimations</code><br />Lists all available default animations. <pre class="vb" xml:space="preserve">Public Enum dlgAnimations As UShort&#13;    Custom               =   0&#13;    SearchFlashlight     = 150&#13;    SearchDocument       = 151&#13;    SearchComputer       = 152&#13;    FileMove             = 160&#13;    FileCopy             = 161&#13;    ToRecycleBinDelete   = 162&#13;    FromRecycleBinDelete = 163&#13;    PermanentDelete      = 164&#13;    FlyingPapers         = 165&#13;    SearchGlobe          = 166&#13;    FileMove95           = 167&#13;    FileCopy95           = 168&#13;    FileDelete95         = 169&#13;    InternetCopy         = 170&#13;    NoAnimation          = UShort.MaxValue&#13;End Enum</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Constructor" src="http://pjondevelopment.50webs.com/images/class/enum.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>dlgLines</code><br />Defines all available lines. <pre class="vb" xml:space="preserve">Public Enum dlgLines As Byte&#13;    LineOne   = 1&#13;    LineTwo   = 2&#13;    LineThree = 3&#13;End Enum</pre></td></tr></tbody></table><br /><h3>Public Constructors</h3><table id="table1" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Constructor" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>ProgressDialog Constructor </code><br />Initializes a new instance of the <b>ProgressDialog</b> Class. <pre class="vb" xml:space="preserve">Public Sub New(ByVal f As Form)&#13;Public Sub New(ByVal hWnd As intPtr)</pre></td></tr></tbody></table><h3>Public Properties</h3><table id="table2" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Animation</code><br />Gets or sets the animation played by the dialog window while processing. <pre class="vb" xml:space="preserve">Public Property Animation() As dlgAnimations</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>AutomaticRemainingTime</code><br />Gets or sets if the remaining time should be calculated automatically.<br /><pre class="vb" xml:space="preserve">Public Property AutomaticRemainingTime() As Boolean</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>CancelMessage</code><br />The message to be displayed if the cancellation process needs to take time.<br /><pre class="vb" xml:space="preserve">Public Property CancelMessage() As String</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Complete</code><br />Gets or sets the amount of the job done.<br /><pre class="vb" xml:space="preserve">Public Property Complete() As ULong</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>HideProgressBar</code><br />Gets or sets the flag that displays the progress bar.<br /><pre class="vb" xml:space="preserve">Public Property HideProgressBar() As Boolean</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>HideRemainingTime</code><br />Gets of sets the flag that displays the remaining time.<br /><pre class="vb" xml:space="preserve">Public Property HideRemainingTime() As Boolean</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>IsModal</code><br />Gets or sets the flag that forces the progress window to be modal.<br /><pre class="vb" xml:space="preserve">Public Property IsModal() As Boolean</pre><strong>Note:</strong> Setting this property after the dialog is being shown has no effect. </td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Title</code><br />The Title to be displayed on the title bar of the dialog.<br /><pre class="vb" xml:space="preserve">Public Property Title() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Total</code><br />Gets or sets the total size of the job.<br /><pre class="vb" xml:space="preserve">Public Property Total() As ULong</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>UserCancelled</code><br />A System.Boolean flag that indicates if the user has cancelled the process.<br /><pre class="vb" xml:space="preserve">Public ReadOnly Property UserCancelled() As Boolean</pre></td></tr></tbody></table><h3>Public Methods</h3><table id="table3" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition"><code>ResetTimer</code><br />Resets the internal timer. <pre class="vb" xml:space="preserve">Public Sub ResetTimer()</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition"><code>SetCustomAnimation</code><br />Defines the custom animation to be used. <pre class="vb" xml:space="preserve">Public Sub SetCustomAnimation( _&#13;                       ByVal hLibrary As IntPtr, _&#13;                       ByVal resNumber As UShort)</pre><p>This method takes the instance handle specified by <i>hLibrary </i>and uses the common control's <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/commctls/animation/animationoverview.asp" shape="rect">animation control </a>to open and run a silent AVI clip. There are several restrictions as to what types of AVI clips can be used: </p><p /><ul class="flower"><li>Clips cannot include sound. </li><li>The size of the AVI clip cannot exceed 272 by 60 pixels. Smaller rectangles can be used, but they might not be properly centered. </li><li>AVI clips must either be uncompressed or compressed with run-length (BI_RLE8) encoding. If you attempt to use an unsupported compression type, no animation will be displayed. </li></ul><p><span><strong>Note:</strong></span><span> The SetCustomAnimation function requires a pointer to a library and the number of the resources to be used. It is beyond the scope of this documentation how to acquire such information. </span></p></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition"><code>SetLineText</code><br />Sets the text to be displayed in one of the three available lines. <pre class="vb" xml:space="preserve">Public Sub SetLineText(ByVal Line As dlgLines, _&#13;                       ByVal Text As String, _&#13;              Optional ByVal CompactPath As Boolean)</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition"><code>Start</code><br />Display the dialog and resets the internal timer. <pre class="vb" xml:space="preserve">Public Sub Start()</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition"><code>Stop</code><br />Closes the dialog. <pre class="vb" xml:space="preserve">Public Sub Stop()</pre></td></tr></tbody></table><h2>Using the code</h2><p>As I stated, using this class is pretty straightforward as can be seen on the function below. </p><pre class="vb" xml:space="preserve">Private Sub DoSomethingLong()&#13;&#13;  '*&#13;  '* Create a new instance of the ProgressDialog Class&#13;  '*&#13;  Dim pd As New ProgressDialog(Me)&#13;&#13;  '*&#13;  '* Initialize the Dialog Properties&#13;  '*&#13;  With pd&#13;    .Complete = 0&#13;    .Total = 10000&#13;    .Title = &quot;Title&quot;&#13;    .Animation = _&#13;        ProgressDialog.dlgAnimations.PermanentDelete&#13;  End With&#13;&#13;  '*&#13;  '* Starts the Dialog&#13;  '*&#13;  pd.Start()&#13;&#13;  '*&#13;  '* Do something long&#13;  '*&#13;  For i As UInteger = 1 To 10000&#13;    pd.Complete += 10&#13;    pd.SetLineText(ProgressDialog.dlgLines.LineTwo, _&#13;            &quot;Item No.&quot; &amp; i)&#13;&#13;    '*&#13;    '* Checks for user cancellation&#13;    '*&#13;    If (pd.UserCancelled) Then&#13;      Exit For&#13;    End If&#13;&#13;    System.Threading.Thread.Sleep(50)&#13;  Next&#13;&#13;  '*&#13;  '* Closes the dialog&#13;  '*&#13;  pd.Stop()&#13;&#13;End Sub</pre><p>I hope you find this code useful in your projects.</p><h2>How to use a custom AVI</h2><p>So far, the only way to use a custom animation is to create an external resource dll and use the following code snippet. </p><pre class="vb" xml:space="preserve">Private Enum llFlags As UInteger&#13;    DontResolveDllReferences = &amp;H1&#13;    LoadLibraryAsDatafile = &amp;H2&#13;    LoadWithAlteredSearchPath = &amp;H8&#13;    LoadIgnoreCodeAuthzLevel = &amp;H10&#13;End Enum&#13;&#13;&lt;DllImport(&quot;kernel32&quot;, _&#13;           CharSet:=CharSet.Auto, _&#13;           SetLastError:=True)&gt; _&#13;Private Shared Function LoadLibraryEx( _&#13;     &lt;MarshalAs(UnmanagedType.LPTStr)&gt; _&#13;        ByVal lpFileName As String, _&#13;        ByVal hFile As IntPtr, _&#13;        ByVal dwFlags As LoadLibraryExFlags) As IntPtr&#13;End Function&#13;&#13;Private Function ShowProgress()&#13;&#13;    Dim pd as New ProcessDialog&#13;    Dim hLibrary as IntPtr&#13;&#13;    '*&#13;    '* Defines a custom animation&#13;    '*&#13;    hLibrary = LoadLibraryEx( _&#13;                &quot;YOUR_RESOURCE_DLL_HERE&quot; &amp; Chr(0), _&#13;                IntPtr.Zero, _&#13;                llFlags.DontResolveDllReferences Or _&#13;                llFlags.LoadLibraryAsDatafile)&#13;&#13;    If (hLibrary &lt;&gt; IntPtr.Zero) Then&#13;        pd.Animation = ProgressDialog.dlgAnimations.Custom&#13;        pd.SetCustomAnimation(hLibrary, _&#13;                              YOUR_RESOURCE_NUMBER_HERE)&#13;    End If&#13;    &#13;    '*&#13;    '* Now you may show the &#13;    '* ProgressDialog as &#13;    '* instructed above.&#13;    '*&#13;&#13;End Function</pre>
